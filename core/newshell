#!/bin/zsh


if [ -z "$_zconfig_booted" ]; then
  zctrace "running newshell..."

  local zcfile
  FPATH=$ZCONFIGDIR/functions:$FPATH
  
  for zcfile in `find $ZCONFIGDIR/local/build/$ZSH_VERSION -name \*.zwc 2>/dev/null `; do
      FPATH=$FPATH:$zcfile
  done

  for zcfile in $ZCONFIGDIR/functions/*; do
    autoload -U `basename $zcfile`
  done

  unset zcfile

  # load default prefs and local prefs
  # zsourcedir prefs.d prefs.d/`uname` hosts/$SHORTHOST/prefs.d
  zrunsystem prefs
  zsource prefs
  
  zrunsystem newshell
  
  _zconfig_booted=1
fi
